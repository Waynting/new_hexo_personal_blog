# Scripts èªªæ˜

æœ¬ç›®éŒ„åŒ…å«ç”¨æ–¼ç®¡ç†åšå®¢å…§å®¹å’Œåœ–ç‰‡çš„è…³æœ¬å·¥å…·ã€‚

**ä½œè€…ï¼š** Wei-Ting Liu

---

## ğŸ“‹ è…³æœ¬åˆ—è¡¨

### `process-local-images.mjs` â­ **æ¨è–¦ä½¿ç”¨**

**åŠŸèƒ½**ï¼šè‡ªå‹•è™•ç†æœ¬åœ°åœ–ç‰‡ä¸¦ä¸Šå‚³åˆ° R2

é€™æ˜¯**æœ€æ¨è–¦**çš„åœ–ç‰‡è™•ç†æ–¹å¼ï¼Œæœƒè‡ªå‹•å®Œæˆæ‰€æœ‰æ­¥é©Ÿï¼š

- âœ… æƒææ‰€æœ‰ Markdown æ–‡ä»¶ä¸­çš„æœ¬åœ°åœ–ç‰‡è·¯å¾‘
- âœ… æ”¯æ´ `file://`ã€çµ•å°è·¯å¾‘å’Œç›¸å°è·¯å¾‘ï¼ˆ`./image.jpg`ï¼‰
- âœ… è‡ªå‹•è½‰æ›ç‚º WebP æ ¼å¼ä¸¦å£“ç¸®
- âœ… è‡ªå‹•ä¸Šå‚³åˆ° Cloudflare R2
- âœ… è‡ªå‹•æ›¿æ›æ–‡ç« ä¸­çš„è·¯å¾‘ç‚º CDN URL
- âœ… è‡ªå‹•æ¸…ç†æ–‡ä»¶åå’Œè·¯å¾‘ä¸­çš„ç©ºæ ¼
- âœ… æ”¯æ´å¿«å–æ©Ÿåˆ¶ï¼Œé¿å…é‡è¤‡ä¸Šå‚³

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
npm run images:process
```

**ä½¿ç”¨ç¯„ä¾‹**ï¼š

1. **å°‡åœ–ç‰‡æ”¾åœ¨æ–‡ç« åŒç›®éŒ„ä¸‹**ï¼š
   ```bash
   content/2025/12/my-article/
   â”œâ”€â”€ my-article.md
   â”œâ”€â”€ photo1.jpg
   â””â”€â”€ photo2.png
   ```

2. **åœ¨æ–‡ç« ä¸­ä½¿ç”¨ç›¸å°è·¯å¾‘**ï¼š
   ```markdown
   ![åœ–ç‰‡èªªæ˜](./photo1.jpg)
   ![å¦ä¸€å¼µåœ–](./photo2.png)
   ```

3. **åŸ·è¡Œè…³æœ¬**ï¼š
   ```bash
   npm run images:process
   ```

4. **çµæœ**ï¼š
   - åœ–ç‰‡æœƒè‡ªå‹•ä¸Šå‚³åˆ° R2ï¼š`blog-post/2025/12/my-article/photo1.webp`
   - æ–‡ç« ä¸­çš„è·¯å¾‘æœƒè‡ªå‹•æ›´æ–°ç‚ºï¼š`https://img.waynspace.com/2025/12/my-article/photo1.webp`
   - æœ¬åœ°åœ–ç‰‡æœƒè¢«è‡ªå‹•åˆªé™¤

**ç’°å¢ƒè®Šæ•¸**ï¼š
- `CF_ACCOUNT_ID` - Cloudflare Account IDï¼ˆå¿…å¡«ï¼‰
- `R2_ACCESS_KEY_ID` - R2 API Access Key IDï¼ˆå¿…å¡«ï¼‰
- `R2_SECRET_ACCESS_KEY` - R2 API Secret Access Keyï¼ˆå¿…å¡«ï¼‰
- `R2_BUCKET` - R2 Bucket åç¨±ï¼ˆé è¨­ï¼š`blog-post`ï¼‰
- `R2_BASE_URL` - CDN åŸºç¤ URLï¼ˆé è¨­ï¼š`https://img.waynspace.com`ï¼‰

**æ³¨æ„äº‹é …**ï¼š
- è…³æœ¬æœƒè‡ªå‹•æ¸…ç†æ–‡ä»¶åå’Œè·¯å¾‘ä¸­çš„ç©ºæ ¼ï¼Œé¿å… URL å•é¡Œ
- å¦‚æœåœ–ç‰‡å·²å­˜åœ¨æ–¼ R2ï¼ˆæ ¹æ“š hashï¼‰ï¼Œæœƒè·³éä¸Šå‚³
- è™•ç†å®Œæˆå¾Œï¼Œæœ¬åœ°åœ–ç‰‡æœƒè¢«è‡ªå‹•åˆªé™¤

---

### `delete-r2-images.mjs`

**åŠŸèƒ½**ï¼šåˆªé™¤ R2 ä¸ŠåŒ…å«ç©ºæ ¼çš„æ–‡ä»¶

ç”¨æ–¼æ¸…ç†å› ç‚ºæ–‡ä»¶åæˆ–è·¯å¾‘ä¸­åŒ…å«ç©ºæ ¼è€Œå°è‡´ç„¡æ³•æ­£ç¢ºè®€å–çš„åœ–ç‰‡ã€‚

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
npm run images:delete-spaces
```

**åŠŸèƒ½èªªæ˜**ï¼š
- æƒæ R2 bucket ä¸­çš„æ‰€æœ‰æ–‡ä»¶
- æ‰¾å‡ºåŒ…å«ç©ºæ ¼çš„æ–‡ä»¶
- é¡¯ç¤ºæ–‡ä»¶åˆ—è¡¨ä¸¦è©¢å•ç¢ºèª
- åˆªé™¤åŒ…å«ç©ºæ ¼çš„æ–‡ä»¶

**ç’°å¢ƒè®Šæ•¸**ï¼š
- `CF_ACCOUNT_ID` - Cloudflare Account IDï¼ˆå¿…å¡«ï¼‰
- `R2_ACCESS_KEY_ID` - R2 API Access Key IDï¼ˆå¿…å¡«ï¼‰
- `R2_SECRET_ACCESS_KEY` - R2 API Secret Access Keyï¼ˆå¿…å¡«ï¼‰
- `R2_BUCKET` - R2 Bucket åç¨±ï¼ˆé è¨­ï¼š`blog-post`ï¼‰

**ä½¿ç”¨å ´æ™¯**ï¼š
- ä¿®æ­£èˆŠåœ–ç‰‡è·¯å¾‘ä¸­çš„ç©ºæ ¼å•é¡Œ
- æ¸…ç†ç„¡æ³•æ­£ç¢ºè¨ªå•çš„åœ–ç‰‡

---

### `update-content-images.mjs`

**åŠŸèƒ½**ï¼šæ›´æ–°æ–‡ç« ä¸­çš„åœ–ç‰‡è·¯å¾‘ç‚º R2 URL

é©ç”¨æ–¼å·²ç¶“æ‰‹å‹•ä¸Šå‚³åœ–ç‰‡åˆ° R2ï¼Œéœ€è¦æ‰¹é‡æ›´æ–°æ–‡ç« ä¸­çš„åœ–ç‰‡è·¯å¾‘çš„æƒ…æ³ã€‚

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
npm run images:update
```

**åŠŸèƒ½èªªæ˜**ï¼š
- æƒæ `content/` ç›®éŒ„ä¸‹çš„æ‰€æœ‰ Markdown æ–‡ä»¶
- å°‡ç›¸å°è·¯å¾‘ï¼ˆå¦‚ `images/photo.jpg`ï¼‰æ›¿æ›ç‚ºå®Œæ•´çš„ R2 URL
- è‡ªå‹•å°‡åœ–ç‰‡è·¯å¾‘è½‰æ›ç‚º `.webp` æ ¼å¼

**ç’°å¢ƒè®Šæ•¸**ï¼š
- `R2_BASE_URL` - CDN åŸºç¤ URLï¼ˆé è¨­ï¼š`https://img.waynspace.com`ï¼‰
- `R2_PREFIX` - R2 è·¯å¾‘å‰ç¶´ï¼ˆé è¨­ï¼š`blog`ï¼‰

**æ³¨æ„**ï¼šæ­¤è…³æœ¬ä¸æœƒä¸Šå‚³åœ–ç‰‡ï¼Œåªæœƒæ›´æ–°è·¯å¾‘ã€‚è«‹ç¢ºä¿åœ–ç‰‡å·²ç¶“åœ¨ R2 ä¸Šã€‚

---

### `verify-r2-images.mjs`

**åŠŸèƒ½**ï¼šé©—è­‰æ–‡ç« ä¸­çš„åœ–ç‰‡è·¯å¾‘æ˜¯å¦æ­£ç¢º

æª¢æŸ¥æ‰€æœ‰æ–‡ç« ä¸­çš„åœ–ç‰‡ URL æ˜¯å¦å°æ‡‰åˆ° R2 ä¸Šçš„å¯¦éš›æ–‡ä»¶ã€‚

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
npm run images:verify
```

**åŠŸèƒ½èªªæ˜**ï¼š
- æƒææ‰€æœ‰æ–‡ç« ä¸­çš„åœ–ç‰‡ URL
- æª¢æŸ¥ R2 ä¸Šæ˜¯å¦å­˜åœ¨å°æ‡‰çš„åœ–ç‰‡
- é¡¯ç¤ºç¼ºå¤±çš„åœ–ç‰‡åˆ—è¡¨

**ç’°å¢ƒè®Šæ•¸**ï¼š
- `R2_BASE_URL` - CDN åŸºç¤ URLï¼ˆé è¨­ï¼š`https://img.waynspace.com`ï¼‰
- `R2_PREFIX` - R2 è·¯å¾‘å‰ç¶´ï¼ˆé è¨­ï¼š`blog`ï¼‰
- `R2_BUCKET` - R2 Bucket åç¨±ï¼ˆé è¨­ï¼š`blog-post`ï¼‰
- `RCLONE_REMOTE` - rclone é ç«¯åç¨±ï¼ˆé è¨­ï¼š`r2`ï¼‰

**ä½¿ç”¨å ´æ™¯**ï¼š
- éƒ¨ç½²å‰æª¢æŸ¥åœ–ç‰‡æ˜¯å¦éƒ½å·²ä¸Šå‚³
- æ’æŸ¥åœ–ç‰‡ 404 éŒ¯èª¤

---

### `publish-images-to-r2.mjs` âš ï¸ **èˆŠç‰ˆè…³æœ¬**

**åŠŸèƒ½**ï¼šå¾ `source/_posts/` ä¸Šå‚³åœ–ç‰‡åˆ° R2ï¼ˆé©ç”¨æ–¼èˆŠçš„ Hexo çµæ§‹ï¼‰

**æ³¨æ„**ï¼šæ­¤è…³æœ¬é©ç”¨æ–¼èˆŠçš„ç›®éŒ„çµæ§‹ã€‚å¦‚æœä½ ç›´æ¥åœ¨ `content/` ä¸‹ç·¨è¼¯ï¼Œè«‹ä½¿ç”¨ `process-local-images.mjs`ã€‚

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
npm run images:publish
```

**ç’°å¢ƒè®Šæ•¸**ï¼š
- `CF_ACCOUNT_ID` - Cloudflare Account ID
- `R2_BUCKET` - R2 Bucket åç¨±ï¼ˆé è¨­ï¼š`blog-post`ï¼‰
- `R2_BASE_URL` - CDN åŸºç¤ URLï¼ˆé è¨­ï¼š`https://img.waynspace.com`ï¼‰
- `R2_PREFIX` - R2 è·¯å¾‘å‰ç¶´ï¼ˆé è¨­ï¼š`blog`ï¼‰
- `RCLONE_REMOTE` - rclone é ç«¯åç¨±ï¼ˆé è¨­ï¼š`r2`ï¼‰

**æ³¨æ„**ï¼šéœ€è¦å…ˆé…ç½® rcloneï¼š
```bash
rclone config
```

---

### `test-r2-config.mjs`

**åŠŸèƒ½**ï¼šæ¸¬è©¦ R2 é…ç½®æ˜¯å¦æ­£ç¢º

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
npm run test:r2
```

**åŠŸèƒ½èªªæ˜**ï¼š
- æª¢æŸ¥ rclone æ˜¯å¦å·²å®‰è£
- æª¢æŸ¥ rclone é ç«¯é…ç½®
- æª¢æŸ¥èƒ½å¦è¨ªå• R2 bucket
- æª¢æŸ¥ç’°å¢ƒè®Šæ•¸é…ç½®
- æ¸¬è©¦ä¸Šå‚³åŠŸèƒ½

**ç’°å¢ƒè®Šæ•¸**ï¼š
- `R2_BUCKET` - R2 Bucket åç¨±ï¼ˆé è¨­ï¼š`blog-post`ï¼‰
- `R2_BASE_URL` - CDN åŸºç¤ URLï¼ˆé è¨­ï¼š`https://img.waynspace.com`ï¼‰
- `R2_PREFIX` - R2 è·¯å¾‘å‰ç¶´ï¼ˆé è¨­ï¼š`blog`ï¼‰
- `RCLONE_REMOTE` - rclone é ç«¯åç¨±ï¼ˆé è¨­ï¼š`r2`ï¼‰

---

## ğŸš€ æ¨è–¦å·¥ä½œæµç¨‹

### æ—¥å¸¸å¯«ä½œæµç¨‹

1. **å‰µå»ºæ–‡ç« **ï¼š
   ```bash
   # åœ¨ content/2025/12/ ä¸‹å‰µå»ºæ–‡ç« 
   content/2025/12/my-article.md
   ```

2. **æº–å‚™åœ–ç‰‡**ï¼š
   ```bash
   # å°‡åœ–ç‰‡æ”¾åœ¨æ–‡ç« åŒç›®éŒ„ä¸‹
   content/2025/12/my-article/
   â”œâ”€â”€ my-article.md
   â”œâ”€â”€ photo1.jpg
   â””â”€â”€ photo2.png
   ```

3. **åœ¨æ–‡ç« ä¸­ä½¿ç”¨ç›¸å°è·¯å¾‘**ï¼š
   ```markdown
   ![åœ–ç‰‡èªªæ˜](./photo1.jpg)
   ![å¦ä¸€å¼µåœ–](./photo2.png)
   ```

4. **åŸ·è¡Œè‡ªå‹•è™•ç†**ï¼š
   ```bash
   npm run images:process
   ```

5. **çµæœ**ï¼š
   - âœ… åœ–ç‰‡è‡ªå‹•ä¸Šå‚³åˆ° R2
   - âœ… è·¯å¾‘è‡ªå‹•æ›´æ–°ç‚º CDN URL
   - âœ… æœ¬åœ°åœ–ç‰‡è‡ªå‹•åˆªé™¤
   - âœ… æ–‡ç« å¯ä»¥ç›´æ¥æäº¤åˆ° Git

---

## ğŸ”§ é…ç½®

æ‰€æœ‰è…³æœ¬éƒ½ä½¿ç”¨ç’°å¢ƒè®Šæ•¸é€²è¡Œé…ç½®ã€‚å»ºè­°å‰µå»º `.env` æ–‡ä»¶ï¼š

```env
# Cloudflare R2 é…ç½®
CF_ACCOUNT_ID=your-account-id
R2_BUCKET=blog-post
R2_BASE_URL=https://img.waynspace.com

# R2 API æ†‘è­‰ï¼ˆç”¨æ–¼ç›´æ¥ä¸Šå‚³ï¼‰
R2_ACCESS_KEY_ID=your-access-key-id
R2_SECRET_ACCESS_KEY=your-secret-access-key

# rclone é ç«¯åç¨±ï¼ˆç”¨æ–¼ rclone ä¸Šå‚³ï¼Œå¯é¸ï¼‰
RCLONE_REMOTE=r2
```

**ç²å– R2 API æ†‘è­‰**ï¼š
1. å‰å¾€ [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. é¸æ“‡ R2 > Manage R2 API Tokens
3. å‰µå»ºæ–°çš„ API Token
4. è¤‡è£½ Access Key ID å’Œ Secret Access Key

---

## ğŸ“ å®Œæ•´ç¯„ä¾‹

### å ´æ™¯ï¼šæ’°å¯«æ–°æ–‡ç« ä¸¦ä¸Šå‚³åœ–ç‰‡

**1. å‰µå»ºæ–‡ç« **ï¼š
```bash
content/2025/12/my-new-article.md
```

**2. æº–å‚™åœ–ç‰‡**ï¼š
```bash
content/2025/12/my-new-article/
â”œâ”€â”€ my-new-article.md
â”œâ”€â”€ cover.jpg
â”œâ”€â”€ screenshot1.png
â””â”€â”€ screenshot2.png
```

**3. ç·¨è¼¯æ–‡ç« **ï¼š
```markdown
---
title: "æˆ‘çš„æ–°æ–‡ç« "
date: 2025-12-01
categories:
  - æŠ€è¡“ç­†è¨˜
author:
  name: Wei-Ting Liu
  email: wayntingliu@gmail.com
---

é€™æ˜¯æ–‡ç« å…§å®¹ã€‚

![å°é¢](./cover.jpg)

![æˆªåœ–1](./screenshot1.png)

![æˆªåœ–2](./screenshot2.png)
```

**4. åŸ·è¡Œè™•ç†**ï¼š
```bash
npm run images:process
```

**5. çµæœ**ï¼š
- åœ–ç‰‡è‡ªå‹•ä¸Šå‚³åˆ°ï¼š`blog-post/2025/12/my-new-article/`
- è·¯å¾‘è‡ªå‹•æ›´æ–°ç‚ºï¼š`https://img.waynspace.com/2025/12/my-new-article/cover.webp`
- æœ¬åœ°åœ–ç‰‡è‡ªå‹•åˆªé™¤
- æ–‡ç« å¯ä»¥ç›´æ¥æäº¤

---

## â“ å¸¸è¦‹å•é¡Œ

### Q: åœ–ç‰‡ä¸Šå‚³å¤±æ•—ï¼Ÿ

A: æª¢æŸ¥ï¼š
1. `.env` æ–‡ä»¶ä¸­çš„é…ç½®æ˜¯å¦æ­£ç¢º
2. R2 API æ†‘è­‰æ˜¯å¦æœ‰æ•ˆ
3. R2 bucket æ˜¯å¦å·²å•Ÿç”¨ Public Access

### Q: åœ–ç‰‡è·¯å¾‘æ²’æœ‰æ›´æ–°ï¼Ÿ

A: 
1. ç¢ºèªåœ–ç‰‡è·¯å¾‘æ ¼å¼æ˜¯å¦æ­£ç¢ºï¼ˆç›¸å°è·¯å¾‘ï¼š`./image.jpg`ï¼‰
2. æª¢æŸ¥è…³æœ¬æ˜¯å¦æˆåŠŸåŸ·è¡Œï¼ˆæŸ¥çœ‹è¼¸å‡ºè¨Šæ¯ï¼‰
3. ç¢ºèªæ–‡ç« æª”æ¡ˆè·¯å¾‘æ˜¯å¦æ­£ç¢ºï¼ˆ`content/YYYY/MM/`ï¼‰

### Q: åœ–ç‰‡é¡¯ç¤º 404ï¼Ÿ

A: 
1. åŸ·è¡Œ `npm run images:verify` æª¢æŸ¥åœ–ç‰‡æ˜¯å¦å­˜åœ¨
2. ç¢ºèª R2 bucket å·²å•Ÿç”¨ Public Access
3. æª¢æŸ¥åœ–ç‰‡ URL æ ¼å¼æ˜¯å¦æ­£ç¢º

### Q: å¦‚ä½•æ‰‹å‹•ä¸Šå‚³å–®å¼µåœ–ç‰‡ï¼Ÿ

A: æ¨è–¦ä½¿ç”¨ `npm run images:process`ï¼Œå®ƒæœƒè‡ªå‹•è™•ç†æ‰€æœ‰åœ–ç‰‡ã€‚å¦‚æœéœ€è¦æ‰‹å‹•ä¸Šå‚³ï¼Œå¯ä»¥ä½¿ç”¨ rcloneï¼š
```bash
rclone copy ~/Pictures/photo.jpg r2:blog-post/2025/12/my-article/ --progress
```

---

## ğŸ“š æ›´å¤šè³‡è¨Š

- è©³ç´°ä½¿ç”¨èªªæ˜è«‹åƒè€ƒ `docs/åœ–ç‰‡ä¸Šå‚³æŒ‡å—.md`
- æ–‡ç« æ’°å¯«æŒ‡å—è«‹åƒè€ƒ `docs/å¦‚ä½•æ’°å¯«æ–‡ç« .md`
- åšå®¢ç¶“ç‡ŸæŒ‡å—è«‹åƒè€ƒ `docs/ç¶“ç‡Ÿ.md`

---

**è¨˜ä½**ï¼šä½¿ç”¨ `npm run images:process` æ˜¯æœ€ç°¡å–®ã€æœ€å¯é çš„æ–¹å¼ï¼
